{"version":3,"sources":["../../../src/auth/guards/auth.guard.ts"],"sourcesContent":["import {\n  CanActivate,\n  ExecutionContext,\n  Injectable,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { Request } from 'express';\nimport { JwtService } from '@nestjs/jwt';\n\n@Injectable()\nexport class AuthGuard implements CanActivate {\n  constructor(private jwtService: JwtService) {}\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const request = context.switchToHttp().getRequest<Request>();\n    const accessToken = request.headers['authorization']?.split(' ')[1];\n\n    if (!accessToken) {\n      throw new UnauthorizedException();\n    }\n    try {\n      const tokenPayload = await this.jwtService.verifyAsync<{\n        sub: string;\n        email: string;\n        roles?: string[];\n        teacherId?: number | null;\n        studentId?: number | null;\n      }>(accessToken);\n      request.user = { \n        id: tokenPayload.sub, \n        email: tokenPayload.email,\n        roles: tokenPayload.roles ?? [],\n        teacherId: tokenPayload.teacherId ?? null,\n        studentId: tokenPayload.studentId ?? null,\n      };\n      return true;\n    } catch {\n      throw new UnauthorizedException();\n    }\n  }\n}\n"],"names":["AuthGuard","canActivate","context","request","switchToHttp","getRequest","accessToken","headers","split","UnauthorizedException","tokenPayload","jwtService","verifyAsync","user","id","sub","email","roles","teacherId","studentId"],"mappings":";;;;+BAUaA;;;eAAAA;;;wBALN;qBAEoB;;;;;;;;;;AAGpB,IAAA,AAAMA,YAAN,MAAMA;IAEX,MAAMC,YAAYC,OAAyB,EAAoB;QAC7D,MAAMC,UAAUD,QAAQE,YAAY,GAAGC,UAAU;QACjD,MAAMC,cAAcH,QAAQI,OAAO,CAAC,gBAAgB,EAAEC,MAAM,IAAI,CAAC,EAAE;QAEnE,IAAI,CAACF,aAAa;YAChB,MAAM,IAAIG,6BAAqB;QACjC;QACA,IAAI;YACF,MAAMC,eAAe,MAAM,IAAI,CAACC,UAAU,CAACC,WAAW,CAMnDN;YACHH,QAAQU,IAAI,GAAG;gBACbC,IAAIJ,aAAaK,GAAG;gBACpBC,OAAON,aAAaM,KAAK;gBACzBC,OAAOP,aAAaO,KAAK,IAAI,EAAE;gBAC/BC,WAAWR,aAAaQ,SAAS,IAAI;gBACrCC,WAAWT,aAAaS,SAAS,IAAI;YACvC;YACA,OAAO;QACT,EAAE,OAAM;YACN,MAAM,IAAIV,6BAAqB;QACjC;IACF;IA3BA,YAAY,AAAQE,UAAsB,CAAE;aAAxBA,aAAAA;IAAyB;AA4B/C"}