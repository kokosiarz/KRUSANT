{"version":3,"sources":["../../src/courses/courses.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { Course } from './course.entity';\nimport { CreateCourseDto } from './dto/create-course.dto';\nimport { UpdateCourseDto } from './dto/update-course.dto';\n\n@Injectable()\nexport class CoursesService {\n  constructor(\n    @InjectRepository(Course)\n    private courseRepository: Repository<Course>,\n  ) {}\n\n  async findAll(): Promise<Course[]> {\n    return await this.courseRepository.find();\n  }\n\n  async findOne(id: number): Promise<Course> {\n    return await this.courseRepository.findOne({ where: { id } });\n  }\n\n  async create(createCourseDto: CreateCourseDto): Promise<Course> {\n    const course = this.courseRepository.create(createCourseDto);\n    return await this.courseRepository.save(course);\n  }\n\n  async update(id: number, updateCourseDto: UpdateCourseDto): Promise<Course> {\n    await this.courseRepository.update(id, updateCourseDto);\n    return await this.findOne(id);\n  }\n\n  async remove(id: number): Promise<void> {\n    await this.courseRepository.delete(id);\n  }\n\n  async batchUpsert(\n    courses: CreateCourseDto[],\n  ): Promise<{ created: number; updated: number; courses: Course[] }> {\n    const results: Course[] = [];\n    let created = 0;\n    let updated = 0;\n\n    for (const courseDto of courses) {\n      // Find existing course by name\n      const existingCourse = await this.courseRepository.findOne({\n        where: { name: courseDto.name },\n      });\n\n      if (existingCourse) {\n        // Update existing course\n        await this.courseRepository.update(existingCourse.id, courseDto);\n        const updatedCourse = await this.findOne(existingCourse.id);\n        results.push(updatedCourse);\n        updated++;\n      } else {\n        // Create new course\n        const newCourse = this.courseRepository.create(courseDto);\n        const savedCourse = await this.courseRepository.save(newCourse);\n        results.push(savedCourse);\n        created++;\n      }\n    }\n\n    return { created, updated, courses: results };\n  }\n}\n"],"names":["CoursesService","findAll","courseRepository","find","findOne","id","where","create","createCourseDto","course","save","update","updateCourseDto","remove","delete","batchUpsert","courses","results","created","updated","courseDto","existingCourse","name","updatedCourse","push","newCourse","savedCourse"],"mappings":";;;;+BAQaA;;;eAAAA;;;wBARc;yBACM;0BACN;8BACJ;;;;;;;;;;;;;;;AAKhB,IAAA,AAAMA,iBAAN,MAAMA;IAMX,MAAMC,UAA6B;QACjC,OAAO,MAAM,IAAI,CAACC,gBAAgB,CAACC,IAAI;IACzC;IAEA,MAAMC,QAAQC,EAAU,EAAmB;QACzC,OAAO,MAAM,IAAI,CAACH,gBAAgB,CAACE,OAAO,CAAC;YAAEE,OAAO;gBAAED;YAAG;QAAE;IAC7D;IAEA,MAAME,OAAOC,eAAgC,EAAmB;QAC9D,MAAMC,SAAS,IAAI,CAACP,gBAAgB,CAACK,MAAM,CAACC;QAC5C,OAAO,MAAM,IAAI,CAACN,gBAAgB,CAACQ,IAAI,CAACD;IAC1C;IAEA,MAAME,OAAON,EAAU,EAAEO,eAAgC,EAAmB;QAC1E,MAAM,IAAI,CAACV,gBAAgB,CAACS,MAAM,CAACN,IAAIO;QACvC,OAAO,MAAM,IAAI,CAACR,OAAO,CAACC;IAC5B;IAEA,MAAMQ,OAAOR,EAAU,EAAiB;QACtC,MAAM,IAAI,CAACH,gBAAgB,CAACY,MAAM,CAACT;IACrC;IAEA,MAAMU,YACJC,OAA0B,EACwC;QAClE,MAAMC,UAAoB,EAAE;QAC5B,IAAIC,UAAU;QACd,IAAIC,UAAU;QAEd,KAAK,MAAMC,aAAaJ,QAAS;YAC/B,+BAA+B;YAC/B,MAAMK,iBAAiB,MAAM,IAAI,CAACnB,gBAAgB,CAACE,OAAO,CAAC;gBACzDE,OAAO;oBAAEgB,MAAMF,UAAUE,IAAI;gBAAC;YAChC;YAEA,IAAID,gBAAgB;gBAClB,yBAAyB;gBACzB,MAAM,IAAI,CAACnB,gBAAgB,CAACS,MAAM,CAACU,eAAehB,EAAE,EAAEe;gBACtD,MAAMG,gBAAgB,MAAM,IAAI,CAACnB,OAAO,CAACiB,eAAehB,EAAE;gBAC1DY,QAAQO,IAAI,CAACD;gBACbJ;YACF,OAAO;gBACL,oBAAoB;gBACpB,MAAMM,YAAY,IAAI,CAACvB,gBAAgB,CAACK,MAAM,CAACa;gBAC/C,MAAMM,cAAc,MAAM,IAAI,CAACxB,gBAAgB,CAACQ,IAAI,CAACe;gBACrDR,QAAQO,IAAI,CAACE;gBACbR;YACF;QACF;QAEA,OAAO;YAAEA;YAASC;YAASH,SAASC;QAAQ;IAC9C;IAxDA,YACE,AACQf,gBAAoC,CAC5C;aADQA,mBAAAA;IACP;AAsDL"}