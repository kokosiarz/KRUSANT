{"version":3,"sources":["../../src/teachers/teachers.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { Repository } from 'typeorm';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Teacher } from './entities/teacher.entity';\nimport { CreateTeacherDto } from './dto/create-teacher.dto';\n\n@Injectable()\nexport class TeachersService {\n  constructor(@InjectRepository(Teacher) private repo: Repository<Teacher>) {}\n  create(body: CreateTeacherDto) {\n    const teacher = this.repo.create(body);\n    return this.repo.save(teacher);\n  }\n\n  async findOneById(id: number) {\n    const teacher = await this.repo.findOneBy({ id });\n    return teacher;\n  }\n  async findOneByEmail(email: string) {\n    const teacher = await this.repo.findOneBy({ email });\n    return teacher;\n  }\n  findAll() {\n    return this.repo.find();\n  }\n  async update(id: number, body: Partial<Teacher>) {\n    const teacher = await this.repo.findOneBy({ id });\n    if (!teacher) {\n      throw new Error('Teacher not found');\n    }\n    return this.repo.save({\n      ...teacher,\n      ...body,\n    });\n  }\n  remove(id: number) {\n    return this.repo.delete(id);\n  }\n  async batchUpsert(\n    teachers: CreateTeacherDto[],\n  ): Promise<{ created: number; updated: number; teachers: Teacher[] }> {\n    const results: Teacher[] = [];\n    let created = 0;\n    let updated = 0;\n\n    for (const teacherDto of teachers) {\n      // Find existing teacher by email\n      const existingTeacher = await this.repo.findOne({\n        where: { email: teacherDto.email },\n      });\n\n      if (existingTeacher) {\n        // Update existing teacher\n        const updatedTeacher = await this.update(\n          existingTeacher.id,\n          teacherDto,\n        );\n        results.push(updatedTeacher);\n        updated++;\n      } else {\n        // Create new teacher\n        const newTeacher = await this.create(teacherDto);\n        results.push(newTeacher);\n        created++;\n      }\n    }\n\n    return { created, updated, teachers: results };\n  }\n}\n"],"names":["TeachersService","create","body","teacher","repo","save","findOneById","id","findOneBy","findOneByEmail","email","findAll","find","update","Error","remove","delete","batchUpsert","teachers","results","created","updated","teacherDto","existingTeacher","findOne","where","updatedTeacher","push","newTeacher"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPc;yBACA;0BACM;+BACT;;;;;;;;;;;;;;;AAIjB,IAAA,AAAMA,kBAAN,MAAMA;IAEXC,OAAOC,IAAsB,EAAE;QAC7B,MAAMC,UAAU,IAAI,CAACC,IAAI,CAACH,MAAM,CAACC;QACjC,OAAO,IAAI,CAACE,IAAI,CAACC,IAAI,CAACF;IACxB;IAEA,MAAMG,YAAYC,EAAU,EAAE;QAC5B,MAAMJ,UAAU,MAAM,IAAI,CAACC,IAAI,CAACI,SAAS,CAAC;YAAED;QAAG;QAC/C,OAAOJ;IACT;IACA,MAAMM,eAAeC,KAAa,EAAE;QAClC,MAAMP,UAAU,MAAM,IAAI,CAACC,IAAI,CAACI,SAAS,CAAC;YAAEE;QAAM;QAClD,OAAOP;IACT;IACAQ,UAAU;QACR,OAAO,IAAI,CAACP,IAAI,CAACQ,IAAI;IACvB;IACA,MAAMC,OAAON,EAAU,EAAEL,IAAsB,EAAE;QAC/C,MAAMC,UAAU,MAAM,IAAI,CAACC,IAAI,CAACI,SAAS,CAAC;YAAED;QAAG;QAC/C,IAAI,CAACJ,SAAS;YACZ,MAAM,IAAIW,MAAM;QAClB;QACA,OAAO,IAAI,CAACV,IAAI,CAACC,IAAI,CAAC;YACpB,GAAGF,OAAO;YACV,GAAGD,IAAI;QACT;IACF;IACAa,OAAOR,EAAU,EAAE;QACjB,OAAO,IAAI,CAACH,IAAI,CAACY,MAAM,CAACT;IAC1B;IACA,MAAMU,YACJC,QAA4B,EACwC;QACpE,MAAMC,UAAqB,EAAE;QAC7B,IAAIC,UAAU;QACd,IAAIC,UAAU;QAEd,KAAK,MAAMC,cAAcJ,SAAU;YACjC,iCAAiC;YACjC,MAAMK,kBAAkB,MAAM,IAAI,CAACnB,IAAI,CAACoB,OAAO,CAAC;gBAC9CC,OAAO;oBAAEf,OAAOY,WAAWZ,KAAK;gBAAC;YACnC;YAEA,IAAIa,iBAAiB;gBACnB,0BAA0B;gBAC1B,MAAMG,iBAAiB,MAAM,IAAI,CAACb,MAAM,CACtCU,gBAAgBhB,EAAE,EAClBe;gBAEFH,QAAQQ,IAAI,CAACD;gBACbL;YACF,OAAO;gBACL,qBAAqB;gBACrB,MAAMO,aAAa,MAAM,IAAI,CAAC3B,MAAM,CAACqB;gBACrCH,QAAQQ,IAAI,CAACC;gBACbR;YACF;QACF;QAEA,OAAO;YAAEA;YAASC;YAASH,UAAUC;QAAQ;IAC/C;IA5DA,YAAY,AAAmCf,IAAyB,CAAE;aAA3BA,OAAAA;IAA4B;AA6D7E"}