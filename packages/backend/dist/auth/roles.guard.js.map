{"version":3,"sources":["../../src/auth/roles.guard.ts"],"sourcesContent":["import { CanActivate, ExecutionContext, Injectable } from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { ROLES_KEY } from './roles.decorator';\nimport { Role } from './roles.enum';\n\n@Injectable()\nexport class RolesGuard implements CanActivate {\n  constructor(private reflector: Reflector) {}\n\n  canActivate(context: ExecutionContext): boolean {\n    const requiredRoles = this.reflector.getAllAndOverride<Role[]>(ROLES_KEY, [\n      context.getHandler(),\n      context.getClass(),\n    ]);\n    if (!requiredRoles || requiredRoles.length === 0) {\n      return true;\n    }\n    const { user } = context.switchToHttp().getRequest();\n    const roles: string[] = user?.roles ?? [];\n    return requiredRoles.some((role) => roles.includes(role));\n  }\n}\n"],"names":["RolesGuard","canActivate","context","requiredRoles","reflector","getAllAndOverride","ROLES_KEY","getHandler","getClass","length","user","switchToHttp","getRequest","roles","some","role","includes"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBAN6C;sBAChC;gCACA;;;;;;;;;;AAInB,IAAA,AAAMA,aAAN,MAAMA;IAGXC,YAAYC,OAAyB,EAAW;QAC9C,MAAMC,gBAAgB,IAAI,CAACC,SAAS,CAACC,iBAAiB,CAASC,yBAAS,EAAE;YACxEJ,QAAQK,UAAU;YAClBL,QAAQM,QAAQ;SACjB;QACD,IAAI,CAACL,iBAAiBA,cAAcM,MAAM,KAAK,GAAG;YAChD,OAAO;QACT;QACA,MAAM,EAAEC,IAAI,EAAE,GAAGR,QAAQS,YAAY,GAAGC,UAAU;QAClD,MAAMC,QAAkBH,MAAMG,SAAS,EAAE;QACzC,OAAOV,cAAcW,IAAI,CAAC,CAACC,OAASF,MAAMG,QAAQ,CAACD;IACrD;IAbA,YAAY,AAAQX,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AAc7C"}