{"version":3,"sources":["../../../src/auth/strategies/jwt.strategy.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport { Request } from 'express';\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  constructor() {\n    super({\n      jwtFromRequest: ExtractJwt.fromExtractors([\n        (request: Request) => {\n          return request?.cookies?.access_token;\n        },\n        ExtractJwt.fromAuthHeaderAsBearerToken(),\n      ]),\n      ignoreExpiration: false,\n      secretOrKey: process.env.JWT_SECRET,\n    });\n  }\n\n  async validate(payload: { \n    sub: number; \n    email: string; \n    name: string; \n    roles?: string[];\n    teacherId?: number | null;\n    studentId?: number | null;\n  }) {\n    return { \n      id: payload.sub, \n      email: payload.email, \n      name: payload.name, \n      roles: payload.roles ?? [],\n      teacherId: payload.teacherId ?? null,\n      studentId: payload.studentId ?? null,\n    };\n  }\n}\n"],"names":["JwtStrategy","PassportStrategy","Strategy","validate","payload","id","sub","email","name","roles","teacherId","studentId","jwtFromRequest","ExtractJwt","fromExtractors","request","cookies","access_token","fromAuthHeaderAsBearerToken","ignoreExpiration","secretOrKey","process","env","JWT_SECRET"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBANc;0BACM;6BACI;;;;;;;;;;AAI9B,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,IAAAA,0BAAgB,EAACC,qBAAQ;IAcxD,MAAMC,SAASC,OAOd,EAAE;QACD,OAAO;YACLC,IAAID,QAAQE,GAAG;YACfC,OAAOH,QAAQG,KAAK;YACpBC,MAAMJ,QAAQI,IAAI;YAClBC,OAAOL,QAAQK,KAAK,IAAI,EAAE;YAC1BC,WAAWN,QAAQM,SAAS,IAAI;YAChCC,WAAWP,QAAQO,SAAS,IAAI;QAClC;IACF;IA7BA,aAAc;QACZ,KAAK,CAAC;YACJC,gBAAgBC,uBAAU,CAACC,cAAc,CAAC;gBACxC,CAACC;oBACC,OAAOA,SAASC,SAASC;gBAC3B;gBACAJ,uBAAU,CAACK,2BAA2B;aACvC;YACDC,kBAAkB;YAClBC,aAAaC,QAAQC,GAAG,CAACC,UAAU;QACrC;IACF;AAmBF"}