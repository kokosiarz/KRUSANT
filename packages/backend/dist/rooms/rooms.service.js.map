{"version":3,"sources":["../../src/rooms/rooms.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { Room } from './room.entity';\nimport { CreateRoomDto } from './dto/create-room.dto';\nimport { UpdateRoomDto } from './dto/update-room.dto';\n\n@Injectable()\nexport class RoomsService {\n  constructor(\n    @InjectRepository(Room)\n    private roomRepository: Repository<Room>,\n  ) {}\n\n  async findAll(): Promise<Room[]> {\n    return await this.roomRepository.find();\n  }\n\n  async findOne(id: number): Promise<Room> {\n    return await this.roomRepository.findOne({ where: { id } });\n  }\n\n  async create(createDto: CreateRoomDto): Promise<Room> {\n    const room = this.roomRepository.create(createDto);\n    return await this.roomRepository.save(room);\n  }\n\n  async update(id: number, updateDto: UpdateRoomDto): Promise<Room> {\n    await this.roomRepository.update(id, updateDto);\n    return await this.findOne(id);\n  }\n\n  async remove(id: number): Promise<void> {\n    await this.roomRepository.delete(id);\n  }\n  async batchUpsert(\n    rooms: CreateRoomDto[],\n  ): Promise<{ created: number; updated: number; rooms: Room[] }> {\n    const results: Room[] = [];\n    let created = 0;\n    let updated = 0;\n\n    for (const roomDto of rooms) {\n      // Find existing room by name\n      const existingRoom = await this.roomRepository.findOne({\n        where: { name: roomDto.name },\n      });\n\n      if (existingRoom) {\n        // Update existing room\n        await this.roomRepository.update(existingRoom.id, roomDto);\n        const updatedRoom = await this.findOne(existingRoom.id);\n        results.push(updatedRoom);\n        updated++;\n      } else {\n        // Create new room\n        const newRoom = this.roomRepository.create(roomDto);\n        const savedRoom = await this.roomRepository.save(newRoom);\n        results.push(savedRoom);\n        created++;\n      }\n    }\n\n    return { created, updated, rooms: results };\n  }\n}\n"],"names":["RoomsService","findAll","roomRepository","find","findOne","id","where","create","createDto","room","save","update","updateDto","remove","delete","batchUpsert","rooms","results","created","updated","roomDto","existingRoom","name","updatedRoom","push","newRoom","savedRoom"],"mappings":";;;;+BAQaA;;;eAAAA;;;wBARc;yBACM;0BACN;4BACN;;;;;;;;;;;;;;;AAKd,IAAA,AAAMA,eAAN,MAAMA;IAMX,MAAMC,UAA2B;QAC/B,OAAO,MAAM,IAAI,CAACC,cAAc,CAACC,IAAI;IACvC;IAEA,MAAMC,QAAQC,EAAU,EAAiB;QACvC,OAAO,MAAM,IAAI,CAACH,cAAc,CAACE,OAAO,CAAC;YAAEE,OAAO;gBAAED;YAAG;QAAE;IAC3D;IAEA,MAAME,OAAOC,SAAwB,EAAiB;QACpD,MAAMC,OAAO,IAAI,CAACP,cAAc,CAACK,MAAM,CAACC;QACxC,OAAO,MAAM,IAAI,CAACN,cAAc,CAACQ,IAAI,CAACD;IACxC;IAEA,MAAME,OAAON,EAAU,EAAEO,SAAwB,EAAiB;QAChE,MAAM,IAAI,CAACV,cAAc,CAACS,MAAM,CAACN,IAAIO;QACrC,OAAO,MAAM,IAAI,CAACR,OAAO,CAACC;IAC5B;IAEA,MAAMQ,OAAOR,EAAU,EAAiB;QACtC,MAAM,IAAI,CAACH,cAAc,CAACY,MAAM,CAACT;IACnC;IACA,MAAMU,YACJC,KAAsB,EACwC;QAC9D,MAAMC,UAAkB,EAAE;QAC1B,IAAIC,UAAU;QACd,IAAIC,UAAU;QAEd,KAAK,MAAMC,WAAWJ,MAAO;YAC3B,6BAA6B;YAC7B,MAAMK,eAAe,MAAM,IAAI,CAACnB,cAAc,CAACE,OAAO,CAAC;gBACrDE,OAAO;oBAAEgB,MAAMF,QAAQE,IAAI;gBAAC;YAC9B;YAEA,IAAID,cAAc;gBAChB,uBAAuB;gBACvB,MAAM,IAAI,CAACnB,cAAc,CAACS,MAAM,CAACU,aAAahB,EAAE,EAAEe;gBAClD,MAAMG,cAAc,MAAM,IAAI,CAACnB,OAAO,CAACiB,aAAahB,EAAE;gBACtDY,QAAQO,IAAI,CAACD;gBACbJ;YACF,OAAO;gBACL,kBAAkB;gBAClB,MAAMM,UAAU,IAAI,CAACvB,cAAc,CAACK,MAAM,CAACa;gBAC3C,MAAMM,YAAY,MAAM,IAAI,CAACxB,cAAc,CAACQ,IAAI,CAACe;gBACjDR,QAAQO,IAAI,CAACE;gBACbR;YACF;QACF;QAEA,OAAO;YAAEA;YAASC;YAASH,OAAOC;QAAQ;IAC5C;IAvDA,YACE,AACQf,cAAgC,CACxC;aADQA,iBAAAA;IACP;AAqDL"}